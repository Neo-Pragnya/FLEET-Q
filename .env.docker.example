# FLEET-Q Docker Environment Configuration Example
# Copy this file to .env for docker-compose usage
# This file contains all environment variables needed for Docker deployment

# =============================================================================
# REQUIRED SNOWFLAKE CONFIGURATION
# =============================================================================
# These variables are required for FLEET-Q to connect to Snowflake
# Replace with your actual Snowflake account details

FLEET_Q_SNOWFLAKE_ACCOUNT=your-snowflake-account.region
FLEET_Q_SNOWFLAKE_USER=your-username
FLEET_Q_SNOWFLAKE_PASSWORD=your-password
FLEET_Q_SNOWFLAKE_DATABASE=your-database

# Optional Snowflake Configuration
FLEET_Q_SNOWFLAKE_SCHEMA=PUBLIC
FLEET_Q_SNOWFLAKE_WAREHOUSE=your-warehouse
FLEET_Q_SNOWFLAKE_ROLE=your-role

# =============================================================================
# POD CONFIGURATION
# =============================================================================
# These settings control individual pod behavior
# Pod IDs are automatically generated if not specified

# Maximum number of concurrent steps per pod
FLEET_Q_MAX_PARALLELISM=10

# Percentage of max parallelism to use (0.0-1.0)
FLEET_Q_CAPACITY_THRESHOLD=0.8

# =============================================================================
# TIMING CONFIGURATION (in seconds)
# =============================================================================
# These settings control the frequency of various operations

# How often pods send heartbeats to Snowflake
FLEET_Q_HEARTBEAT_INTERVAL_SECONDS=30

# How often pods attempt to claim new steps
FLEET_Q_CLAIM_INTERVAL_SECONDS=5

# How often pods check for leader election changes
FLEET_Q_LEADER_CHECK_INTERVAL_SECONDS=60

# How often the leader runs recovery cycles
FLEET_Q_RECOVERY_INTERVAL_SECONDS=300

# How long before a pod is considered dead (no heartbeat)
FLEET_Q_DEAD_POD_THRESHOLD_SECONDS=180

# =============================================================================
# BACKOFF CONFIGURATION
# =============================================================================
# These settings control retry behavior for failed operations

# Maximum number of retry attempts
FLEET_Q_DEFAULT_MAX_ATTEMPTS=5

# Initial delay between retries (milliseconds)
FLEET_Q_DEFAULT_BASE_DELAY_MS=100

# Maximum delay between retries (milliseconds)
FLEET_Q_DEFAULT_MAX_DELAY_MS=30000

# =============================================================================
# API CONFIGURATION
# =============================================================================
# These settings control the FastAPI server

# Host to bind the API server (0.0.0.0 for all interfaces in containers)
FLEET_Q_API_HOST=0.0.0.0

# Port to bind the API server
FLEET_Q_API_PORT=8000

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================
# These settings control logging output

# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
FLEET_Q_LOG_LEVEL=INFO

# Log format: json (structured) or text (human-readable)
FLEET_Q_LOG_FORMAT=json

# =============================================================================
# SQLITE CONFIGURATION
# =============================================================================
# These settings control local SQLite storage for DLQ operations

# Path to SQLite database file (use :memory: for in-memory)
# In containers, use /app/data/ for persistent storage
FLEET_Q_SQLITE_DB_PATH=/app/data/fleet_q.db

# =============================================================================
# DEVELOPMENT OVERRIDES
# =============================================================================
# Uncomment these for faster development cycles

# Faster timing for development (uncomment to enable)
# FLEET_Q_HEARTBEAT_INTERVAL_SECONDS=10
# FLEET_Q_CLAIM_INTERVAL_SECONDS=2
# FLEET_Q_LEADER_CHECK_INTERVAL_SECONDS=30
# FLEET_Q_RECOVERY_INTERVAL_SECONDS=60
# FLEET_Q_DEAD_POD_THRESHOLD_SECONDS=30

# Development logging (uncomment to enable)
# FLEET_Q_LOG_LEVEL=DEBUG
# FLEET_Q_LOG_FORMAT=text

# Faster backoff for development (uncomment to enable)
# FLEET_Q_DEFAULT_MAX_ATTEMPTS=3
# FLEET_Q_DEFAULT_BASE_DELAY_MS=50
# FLEET_Q_DEFAULT_MAX_DELAY_MS=5000

# =============================================================================
# CONTAINER-SPECIFIC CONFIGURATION
# =============================================================================
# These variables are typically set in docker-compose.yml per service
# but can be overridden here for testing

# Unique pod identifier (auto-generated if not set)
# FLEET_Q_POD_ID=custom-pod-id

# =============================================================================
# EXAMPLE CONFIGURATIONS
# =============================================================================

# Example 1: High-throughput configuration
# FLEET_Q_MAX_PARALLELISM=20
# FLEET_Q_CLAIM_INTERVAL_SECONDS=1
# FLEET_Q_HEARTBEAT_INTERVAL_SECONDS=15

# Example 2: Conservative configuration
# FLEET_Q_MAX_PARALLELISM=5
# FLEET_Q_CLAIM_INTERVAL_SECONDS=10
# FLEET_Q_HEARTBEAT_INTERVAL_SECONDS=60

# Example 3: Development configuration
# FLEET_Q_MAX_PARALLELISM=3
# FLEET_Q_CLAIM_INTERVAL_SECONDS=2
# FLEET_Q_LOG_LEVEL=DEBUG
# FLEET_Q_LOG_FORMAT=text

# =============================================================================
# NOTES
# =============================================================================
# 
# 1. All timing values are in seconds unless otherwise specified
# 2. Backoff delays are in milliseconds
# 3. Pod IDs are automatically generated using hostname and timestamp if not specified
# 4. SQLite paths should use /app/data/ in containers for persistence
# 5. Use FLEET_Q_LOG_FORMAT=json for production, text for development
# 6. The capacity threshold should typically be 0.8 (80%) to leave headroom
# 7. Recovery interval should be 3-5x the dead pod threshold
# 8. Claim interval affects throughput but also database load
# 9. Heartbeat interval affects failure detection speed
# 10. All configuration is validated at startup with clear error messages